關於 agent.py 的改動說明

### 1. 改動目標
原本的紅綠燈控制可能較為固定或隨機，效率不佳。我的目標是實作一個「流量導向 (Volume-Based)」的控制策略，讓車流量大的方向獲得更長的綠燈時間，減少整體等待時間。

### 2. 核心改動與實作方式

#### A. 新增路口狀態管理 (`intersection_controllers`)
- **做法**：我建立了一個全域字典 `intersection_controllers`。
- **原因**：Agent 的 `step` 函式每秒都會被呼叫，我需要一個地方「記住」每個路口現在是綠燈還是紅燈，以及綠燈還剩下幾秒。不這樣做的話，Agent 會「失憶」，無法執行持續性的綠燈。

#### B. 實作車流量偵測函式 (`get_waiting_counts`)
- **做法**：撰寫了一個新的輔助函式，接收環境物件 (`env`) 和路口座標。
- **邏輯**：
  1. 取得場景上所有車輛的資料 (`env.get_vehicle_states()`).
  2. 針對指定路口的「上、下、左、右」四個相鄰座標進行檢查。
  3. 如果該座標有車，且車頭方向是「朝向路口」，就計入排隊數量。
  4. 分別回傳「南北向 (NS)」和「東西向 (EW)」的排隊車數。

#### C. 設計動態秒數計算公式 (`calculate_duration`)
- **做法**：定義公式 `綠燈秒數 = 基礎秒數 (5s) + (排隊車數 * 每車加時 (3s))`。
- **限制**：設定最大上限 30 秒，避免單一方向綠燈太久導致另一方無限等待。

#### D. 重寫決策主迴圈 (`step`)
- **做法**：在 `step` 函式中遍歷所有路口。
- **流程**：
  1. 將該路口的倒數計時器減 1。
  2. **如果計時器歸零**：
     - 呼叫 `get_waiting_counts` 看哪邊車多。
     - 切換燈號 (例如 NS 變 EW)。
     - 用公式算出新的綠燈時間。
     - 重設該路口的計時器。
  3. **如果計時器未歸零**：
     - 維持目前的燈號不變。
  4. 呼叫 `env.control_intersection` 執行燈號。
  5. 最後呼叫 `env.update_intersections()` 更新環境內部的燈號計時。

### 3. 改動後的程式碼結構
完整的程式碼已包含在此目錄下的 `agent_code.txt` 中。
主要新增了：
- `intersection_controllers` (變數)
- `MIN_GREEN_TIME`, `MAX_GREEN_TIME`, `TIME_PER_CAR` (常數)
- `get_waiting_counts` (函式)
- `calculate_duration` (函式)
並大幅修改了 `step` 函式的邏輯。

### 4. 簡單來說 (TL;DR)
這個紅綠燈是**「看車量決定綠燈亮多久」**。

它的運作邏輯如下：

1.  **會「數」車子**：當紅綠燈準備換邊時，它會偷看下一個要走的綠燈方向目前有幾台車在等。
2.  **車多亮久一點**：
    *   基本的綠燈時間是 **5秒**。
    *   每多一台車在等，綠燈就加 **3秒**。
    *   但是最久只會亮 **30秒**（避免另一邊等太久）。
3.  **輪流切換**：時間到了就換另一邊綠燈，然後重複上面的動作。

也就是說，如果南北向車很多，南北向的綠燈就會比較久；如果東西向沒車，東西向的綠燈就會很快結束，讓南北向繼續走。
